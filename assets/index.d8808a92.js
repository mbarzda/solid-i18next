const g=/(?:<!--[\S\s]*?-->|<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>)/g,v=/(?:\s(?<boolean>[^/\s><=]+?)(?=[\s/>]))|(?:(?<name>\S+?)(?:\s*=\s*(?:(['"])(?<quotedValue>[\s\S]*?)\3|(?<unquotedValue>[^\s>]+))))/g,x={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};function y(t){const e={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},n=t.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(e.name=n[1],(x[n[1].toLowerCase()]||t.charAt(t.length-2)==="/")&&(e.voidElement=!0),e.name.startsWith("!--"))){const r=t.indexOf("-->");return{type:"comment",comment:r!==-1?t.slice(4,r):""}}const s=new RegExp(v);for(const r of t.matchAll(s))e.attrs[r[1]||r[2]]=r[4]||r[5]||"";return e}function m(t,e,n){const s=e.indexOf("<",n),r=e.slice(n,s===-1?void 0:s);/^\s*$/.test(r)||t.push({type:"text",content:r})}function f(t,e){const n=e.replace("<!--","").replace("-->","");/^\s*$/.test(n)||t.push({type:"comment",content:n})}function k(t){const e=[];let n,s=-1;const r=[],h={};return t.replace(g,(i,d)=>{const l=i.charAt(1)!=="/",o=i.slice(0,4)==="<!--",a=d+i.length,u=t.charAt(a);let c;l&&!o&&(s++,n=y(i),!n.voidElement&&u&&u!=="<"&&m(n.children,t,a),h[n.tagName]=n,s===0&&e.push(n),c=r[s-1],c&&c.children.push(n),r[s]=n),o&&(s<0?f(e,i):f(r[s].children,i)),(o||!l||n.voidElement)&&(o||s--,u!=="<"&&u&&(c=s===-1?e:r[s].children,m(c,t,a)))}),e}function E(t){const e=[];for(const n in t)e.push(n+'="'+t[n].replace(/"/g,"&quot;")+'"');return e.length?" "+e.join(" "):""}function p(t,e){switch(e.type){case"text":return t+e.content;case"tag":return t+="<"+e.name+(e.attrs?E(e.attrs):"")+(e.voidElement?"/>":">"),e.voidElement?t:t+e.children.reduce(p,"")+"</"+e.name+">";case"comment":return t+="<!--"+e.content+"-->"}}function w(t){return t.reduce(function(e,n){return e+p("",n)},"")}export{k as parse,w as stringify};
