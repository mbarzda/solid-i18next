const v=/(?:<!--[\S\s]*?-->|<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>)/g,g=/(?:\s(?<boolean>[^/\s><=]+?)(?=[\s/>]))|(?:(?<name>\S+?)(?:\s*=\s*(?:(['"])(?<quotedValue>[\s\S]*?)\3|(?<unquotedValue>[^\s>]+))))/g,y={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};function x(t){const e={type:"tag",name:"",voidElement:!1,attrs:[],children:[]},n=t.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(e.name=n[1],(y[n[1].toLowerCase()]||t.charAt(t.length-2)==="/")&&(e.voidElement=!0),e.name.startsWith("!--"))){const r=t.indexOf("-->");return{type:"comment",comment:r!==-1?t.slice(4,r):""}}const s=new RegExp(g);for(const r of t.matchAll(s))(r[1]||r[2]).startsWith("use:")?e.attrs.push({type:"directive",name:r[1]||r[2],value:r[4]||r[5]||""}):e.attrs.push({type:"attr",name:r[1]||r[2],value:r[4]||r[5]||""});return e}function m(t,e,n){const s=e.indexOf("<",n),r=e.slice(n,s===-1?void 0:s);/^\s*$/.test(r)||t.push({type:"text",content:r})}function p(t,e){const n=e.replace("<!--","").replace("-->","");/^\s*$/.test(n)||t.push({type:"comment",content:n})}function k(t){const e=[];let n,s=-1;const r=[],h={};return t.replace(v,(i,d)=>{const l=i.charAt(1)!=="/",u=i.slice(0,4)==="<!--",a=d+i.length,o=t.charAt(a);let c;l&&!u&&(s++,n=x(i),!n.voidElement&&o&&o!=="<"&&m(n.children,t,a),h[n.tagName]=n,s===0&&e.push(n),c=r[s-1],c&&c.children.push(n),r[s]=n),u&&(s<0?p(e,i):p(r[s].children,i)),(u||!l||n.voidElement)&&(u||s--,o!=="<"&&o&&(c=s===-1?e:r[s].children,m(c,t,a)))}),e}function E(t){const e=[];for(const n of t)e.push(n.name+'="'+n.value.replace(/"/g,"&quot;")+'"');return e.length?" "+e.join(" "):""}function f(t,e){switch(e.type){case"text":return t+e.content;case"tag":return t+="<"+e.name+(e.attrs?E(e.attrs):"")+(e.voidElement?"/>":">"),e.voidElement?t:t+e.children.reduce(f,"")+"</"+e.name+">";case"comment":return t+="<!--"+e.content+"-->"}}function w(t){return t.reduce(function(e,n){return e+f("",n)},"")}export{k as parse,w as stringify};
